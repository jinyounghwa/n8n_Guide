# 프로젝트 1: 자동 뉴스 요약 시스템

> RSS 피드에서 뉴스를 수집하고 Claude API로 요약하여 Slack에 발송합니다.
> 예상 완성 시간: 2시간

## 프로젝트 개요

### 목표
```
매일 오전 9시에 RSS 피드에서 최신 뉴스를 수집 
→ Claude API로 한 문장 요약 생성 
→ Slack 채널에 발송
```

### 결과 예시
```
🔔 오늘의 뉴스 요약

📰 AI 기술이 의료 산업 혁신
→ 요약: 최신 AI 모델이 의료 진단 정확도를 85% 향상시켰습니다.

📰 새 프로그래밍 언어 출시
→ 요약: 성능과 안정성을 개선한 새로운 프로그래밍 언어가 공개되었습니다.
```

### 사용 기술
- 🔗 **Webhook** / **Schedule**: 트리거
- 📰 **RSS Reader**: 뉴스 수집
- 🤖 **HTTP (Claude API)**: 요약 생성
- 💬 **Slack**: 메시지 발송
- 🔄 **Loop**: 각 뉴스 처리

---

## 단계 1: 준비 작업

### 1.1 Slack Webhook URL 준비

1. Slack 워크스페이스 관리
2. **App 생성** → "Incoming Webhooks" 활성화
3. Webhook URL 복사 (예: https://hooks.slack.com/services/...)

### 1.2 RSS 피드 URL 선택

사용할 RSS 피드 URL들:

```
기술뉴스:
- https://news.ycombinator.com/rss
- https://feeds.techcrunch.com/techcrunch/feed

일반뉴스:
- https://feeds.bloomberg.com/markets/news.rss

한국뉴스:
- https://feeds.yonhapnews.co.kr/YALatestNews/feed/c_KR.xml (또는 원하는 RSS 피드)
```

### 1.3 필요한 Credentials

```
- Claude API Key: {{ $env.CLAUDE_API_KEY }}
- Slack Webhook: {{ $env.SLACK_WEBHOOK_URL }}
```

n8n Settings에서 환경 변수 설정하기:

```
CLAUDE_API_KEY=sk-ant-...
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...
```

---

## 단계 2: 워크플로우 설계

### 전체 흐름

```
┌─ Start (Daily 9 AM)
│
├─ Fetch RSS Feed
│   └─ Parse RSS items
│
├─ Loop (각 뉴스마다)
│   ├─ Extract Title & Description
│   ├─ Call Claude API
│   │   └─ Generate 1-line Summary
│   ├─ Format Message
│   └─ Send to Slack
│
└─ End
```

---

## 단계 3: 워크플로우 구현

### 3.1 트리거 설정: Schedule

1. 캔버스에 **Schedule** 노드 추가
2. 설정:
   ```
   - Trigger type: Every Day
   - Every: 9:00 AM
   - Timezone: Asia/Seoul (또는 원하는 시간대)
   ```

### 3.2 RSS 피드 수집

#### 방법 1: RSS Reader 노드 사용 (있으면)
```
검색: "RSS"
노드: RSS Reader (또는 유사)

설정:
- URL: https://feeds.yonhapnews.co.kr/YALatestNews/feed/c_KR.xml
- Poll Interval: 1 hour
- Max Items: 5
```

#### 방법 2: HTTP로 RSS 파싱
```
HTTP 노드 추가:
- Method: GET
- URL: https://feeds.yonhapnews.co.kr/YALatestNews/feed/c_KR.xml
- Headers: 없음
```

응답은 XML 형식이므로 파싱 필요:

```json
XML 파싱 (Set 노드):
{
  "items": "{{ $json.body.match(/<item>([\s\S]*?)<\/item>/g) || [] }}",
  "count": "{{ ($json.body.match(/<item>/g) || []).length }}"
}
```

### 3.3 데이터 준비: 첫 번째 Set 노드

```json
{
  "feed_items": [
    {
      "title": "뉴스 제목 1",
      "description": "뉴스 설명 1"
    },
    {
      "title": "뉴스 제목 2",
      "description": "뉴스 설명 2"
    }
  ],
  "total_items": 2
}
```

**또는 실제 구현:**

HTTP 응답에서 동적으로 추출하는 JavaScript 활용

### 3.4 Loop: 각 뉴스 처리

1. **Loop 노드** 추가
2. 설정:
   ```
   - Mode: Array
   - Array: {{ $json.feed_items }}
   ```

### 3.5 Loop 내부: Claude 호출

1. **HTTP 노드** 추가
2. 설정:
   ```
   메서드: POST
   URL: https://api.anthropic.com/v1/messages
   
   Headers:
   - Content-Type: application/json
   - x-api-key: {{ $env.CLAUDE_API_KEY }}
   - anthropic-version: 2023-06-01
   
   Body (JSON):
   {
     "model": "claude-3-5-sonnet-20241022",
     "max_tokens": 150,
     "system": "당신은 뉴스 요약 전문가입니다. 주어진 뉴스를 1-2문장으로 간결하게 요약해주세요. 한국어로 응답하세요.",
     "messages": [
       {
         "role": "user",
         "content": "다음 뉴스를 요약해줘:\n\n제목: {{ $item.json.title }}\n설명: {{ $item.json.description }}"
       }
     ]
   }
   ```

### 3.6 Loop 내부: 응답 처리

**Set 노드** 추가:

```json
{
  "original_title": "{{ $item.json.title }}",
  "original_description": "{{ $item.json.description }}",
  "summary": "{{ $json.body.content[0].text }}",
  "processed": true
}
```

### 3.7 Loop 내부: Slack 메시지 전송

1. **Slack** 노드 추가 (또는 HTTP)
2. Slack 노드 설정:
   ```
   - Webhook URL: {{ $env.SLACK_WEBHOOK_URL }}
   - Message:
     "📰 *{{ $item.json.title }}*\n\n➡️ *요약:* {{ $json.body.content[0].text }}"
   ```

또는 HTTP로 수동 구현:

```
HTTP 노드:
메서드: POST
URL: {{ $env.SLACK_WEBHOOK_URL }}

Body (JSON):
{
  "text": "📰 오늘의 뉴스 요약",
  "attachments": [
    {
      "color": "#36a64f",
      "title": "{{ $item.json.title }}",
      "text": "{{ $json.body.content[0].text }}",
      "footer": "요약된 시간: {{ now() }}"
    }
  ]
}
```

---

## 단계 4: 완전한 워크플로우 코드

### n8n JSON 형식

```json
{
  "nodes": [
    {
      "parameters": {},
      "name": "Schedule",
      "type": "n8n-nodes-base.schedule",
      "typeVersion": 1,
      "position": [100, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://feeds.yonhapnews.co.kr/YALatestNews/feed/c_KR.xml"
      },
      "name": "Fetch RSS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [300, 300]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{ \"items\": [] }"
      },
      "name": "Parse RSS",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [500, 300]
    },
    {
      "parameters": {
        "mode": "array",
        "arrayInput": "={{ $json.items }}"
      },
      "name": "Loop Items",
      "type": "n8n-nodes-base.loop",
      "typeVersion": 1,
      "position": [700, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "headers": {
          "Content-Type": "application/json",
          "x-api-key": "={{ $env.CLAUDE_API_KEY }}",
          "anthropic-version": "2023-06-01"
        },
        "body": "={...}"
      },
      "name": "Claude Summarize",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [900, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.SLACK_WEBHOOK_URL }}",
        "body": "={...}"
      },
      "name": "Send to Slack",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1100, 300]
    }
  ],
  "connections": {
    "Schedule": { "main": [["Fetch RSS"]] },
    "Fetch RSS": { "main": [["Parse RSS"]] },
    "Parse RSS": { "main": [["Loop Items"]] },
    "Loop Items": { "main": [["Claude Summarize"]] },
    "Claude Summarize": { "main": [["Send to Slack"]] }
  }
}
```

---

## 단계 5: 테스트

### 5.1 수동 테스트

1. 워크플로우 저장
2. **Execute Workflow** 클릭
3. 각 단계 실행 확인

### 5.2 각 노드별 테스트

1. **Schedule** 후 실행 확인
2. **Fetch RSS** 응답 확인
3. **Claude** 응답 확인
4. **Slack** 메시지 확인

### 5.3 문제 해결

```
❌ RSS 파싱 실패
  → URL이 유효한지 확인
  → XML 형식 확인
  → 파싱 로직 수정

❌ Claude API 오류
  → API 키 확인
  → 헤더 형식 확인
  → 요청 body 검증

❌ Slack 메시지 미발송
  → Webhook URL 확인
  → JSON 형식 확인
  → 권한 확인
```

---

## 단계 6: 고급 기능 추가

### 6.1 뉴스 필터링

중복되는 뉴스 제거:

```json
{
  "articles": "{{ $json.items.filter((item, index, self) => index === self.findIndex((t) => t.title === item.title)) }}"
}
```

### 6.2 카테고리별 정렬

다양한 뉴스원에서 수집:

```
1. 기술뉴스 RSS
2. 일반뉴스 RSS
3. 한국뉴스 RSS

각각 병렬로 처리 → 결합 → 정렬
```

### 6.3 감정 분석 추가

```
Claude 호출:
"뉴스 제목과 설명을 분석하여 감정을 긍정/부정/중립으로 분류해주세요."
```

### 6.4 데이터베이스 저장

매일 요약된 뉴스를 저장:

```
Loop 내부:
[Claude 호출] → [Database 저장] → [Slack 발송]
```

### 6.5 에러 처리

```
[Try-Catch 활용]
- 성공: 계속 진행
- 실패: 재시도 또는 알림
```

---

## 단계 7: 배포 및 자동화

### 7.1 워크플로우 활성화

```
워크플로우 상단 "Activate" 토글 활성화
→ 매일 오전 9시에 자동 실행
```

### 7.2 모니터링

좌측 **Executions** 탭에서:
- 실행 시간
- 성공/실패 여부
- 처리된 뉴스 수

### 7.3 알림 설정

실패 시 알림 받기:

```
[Try-Catch]
  Success: 정상 진행
  Error: 
    ├─ Slack 에러 알림
    ├─ 이메일 전송
    └─ 로그 저장
```

---

## 체크리스트

프로젝트 완료 확인:

- [ ] RSS 피드에서 뉴스 수집 성공
- [ ] Claude API를 사용한 요약 생성
- [ ] Slack에 메시지 발송
- [ ] Loop를 통해 여러 뉴스 처리
- [ ] 일일 스케줄 설정
- [ ] 테스트 완료
- [ ] 워크플로우 활성화

모두 완료했다면 축하합니다! 🎉

---

## 다음 단계

**프로젝트 2: 고객 응답 자동화**에서 배우는 것:
- 이메일 자동 수신 및 처리
- 고객 질의에 자동 응답
- 복잡한 조건 처리
- CRM 통합
