# 4장: 기본 노드 마스터하기

> n8n의 가장 많이 사용되는 기본 노드들을 배웁니다.
> 예상 학습 시간: 1.5시간

## 노드의 분류

```
┌─ Trigger (트리거)
│  └─ 워크플로우를 시작하는 노드
│
├─ Action (액션)
│  └─ 실제 작업을 수행하는 노드
│
├─ Logic (로직)
│  └─ 데이터를 처리하는 노드
│
└─ Network (네트워크)
   └─ 외부 서비스와 통신하는 노드
```

---

## 트리거 노드 (Trigger Nodes)

### 1. Webhook

**용도**: HTTP 요청으로 워크플로우 시작

```
설정:
- HTTP Method: GET, POST, PUT, DELETE
- Authentication: None, Basic, API Key 등
- Response Code: 200, 201 등

사용 예시:
curl -X POST http://localhost:5678/webhook/[id] \
  -H "Content-Type: application/json" \
  -d '{"name": "John"}'
```

### 2. Schedule

**용도**: 정해진 시간에 자동 실행

```
설정:
- Interval: 매 시간, 매일, 매주
- Daily Time: 특정 시간
- Custom: Cron 표현식

예시:
- 매일 9시: 0 9 * * *
- 매 시간: 0 * * * *
- 매주 월요일 9시: 0 9 * * 1
```

### 3. File Trigger

**용도**: 파일 생성/수정 감지

```
설정:
- Watch Directory: 감시할 폴더
- File Name Pattern: *.csv 등
```

---

## 액션 노드 (Action Nodes)

### 1. HTTP Request

**용도**: 외부 API 호출

```
설정:
- Method: GET, POST, PUT, DELETE
- URL: https://api.example.com/data
- Headers: Authorization, Content-Type 등
- Body: JSON, Form Data 등

예시:
Method: POST
URL: https://api.example.com/users
Body:
{
  "name": "{{ $json.body.name }}",
  "email": "{{ $json.body.email }}"
}

응답 접근:
{{ $json.body.user_id }}
{{ $json.status }}
```

### 2. Set

**용도**: 변수 설정 및 데이터 변환

```
사용법:
1. "Add value" 클릭
2. 필드명 입력: "user_name"
3. 값 입력: "{{ $json.body.name }}"

자주 사용되는 패턴:
{
  "name": "{{ $json.name }}",
  "email": "{{ $json.email }}",
  "timestamp": "{{ now() }}",
  "id": "{{ $randomUUID() }}"
}
```

### 3. Merge

**용도**: 여러 노드의 데이터 병합

```
설정:
- Mode: Different ways to merge
  - Combine: 모두 합치기
  - Merge By Key: 특정 키로 병합
  - Concatenate: 배열 이어붙이기

예시:
[노드1 결과] → [Merge]
                 ↓
[노드2 결과] →  [모두 합쳐진 데이터]
```

---

## 로직 노드 (Logic Nodes)

### 1. If

**용도**: 조건부 실행

```
설정:
Condition:
- Field: 검사할 필드
- Operator: ==, !=, >, < 등
- Value: 비교값

예시:
IF {{ $json.age }} > 18
  THEN: 성인 처리
  ELSE: 미성년자 처리
```

### 2. Switch

**용도**: 여러 조건 분기

```
설정:
Multiple conditions:
- Condition 1: {{ $json.type }} === 'A'
- Condition 2: {{ $json.type }} === 'B'
- Default: 위 조건에 맞지 않음

응용:
switch ({{ $json.status }}) {
  case 'pending': → 대기 처리
  case 'approved': → 승인 처리
  case 'rejected': → 거절 처리
  default: → 오류 처리
}
```

### 3. Loop

**용도**: 배열 각 요소마다 실행

```
설정:
- Mode: Array
- Array: {{ $json.items }}

각 반복마다:
- {{ $item.json }} 사용 가능
- 인덱스: $index
- 전체 길이: {{ $json.items.length }}

예시:
items = [
  {name: "item1"},
  {name: "item2"},
  {name: "item3"}
]

Loop 내부에서:
{{ $item.json.name }} → "item1", "item2", "item3" 순서로
```

---

## 데이터 처리 노드

### 1. Split In Batches

**용도**: 큰 배열을 작은 묶음으로 나누기

```
설정:
- Batch Size: 한 번에 처리할 개수 (10, 50, 100 등)

예시:
1000개 항목 → Split (50개씩) → 20번 반복
```

### 2. Item Lists

**용도**: 배열 변환

```
Mode: Remove Duplicates
  → 중복 제거
  
Mode: Combine arrays
  → 여러 배열 합치기
  
Mode: Sort
  → 정렬
```

### 3. JSON

**용도**: JSON 데이터 처리

```
설정:
- Action: Parse JSON, To JSON 등

예시:
JSON.parse('{"name":"John"}')
JSON.stringify({name: "John"})
```

---

## 통신 노드 (Communication Nodes)

### 1. Email Send

**용도**: 이메일 발송

```
설정:
- To: 수신자 이메일
- Subject: 제목
- Text/HTML: 본문
- Attachments: 첨부파일

예시:
To: {{ $json.user.email }}
Subject: 주문 확인
Text: 감사합니다!
```

### 2. Slack

**용도**: Slack 메시지 발송

```
설정:
- Webhook URL 또는 Token 선택
- Channel: #general 또는 DM
- Message: 메시지 내용

예시:
Message: "📦 *주문 완료*\n수주번호: {{ $json.order_id }}"
```

### 3. Webhook (응답)

**용도**: 외부에 데이터 전송

```
설정:
- URL: 받을 쪽 서버 주소
- Method: POST
- Headers, Body: 데이터
```

---

## 실전 예시 모음

### 예시 1: 사용자 등록 워크플로우

```
[Webhook] → [검증] → [HTTP POST] → [이메일] → [응답]
```

### 예시 2: 데이터 수집 및 정렬

```
[Schedule] → [HTTP] → [Set] → [Sort] → [Database]
```

### 예시 3: 조건부 처리

```
[Webhook]
  ↓
[If: 유형 확인]
  ├─ 유형 A → [처리1] → [저장1]
  ├─ 유형 B → [처리2] → [저장2]
  └─ 기타 → [거절]
```

### 예시 4: 배치 처리

```
[Webhook] 
  ↓
[Split In Batches: 100개씩]
  ↓
[Loop]
  ├─ [API 호출]
  └─ [결과 수집]
  ↓
[병합] → [저장]
```

---

## 표현식 심화 학습

### 기본 문법

```javascript
// 데이터 접근
{{ $json.field }}                 // 현재 데이터
{{ $node["Set"].json.field }}     // 다른 노드의 데이터
{{ $item.json.field }}            // Loop 내부

// 배열 조작
{{ $json.items[0] }}              // 첫 번째 요소
{{ $json.items.length }}          // 배열 길이
{{ $json.items.map(x => x.id) }}  // 매핑
{{ $json.items.filter(x => x.active) }}  // 필터링

// 문자열 조작
{{ $json.text.toUpperCase() }}    // 대문자
{{ $json.text.substring(0, 5) }}  // 부분 추출
{{ $json.text.split(',') }}       // 분리

// 날짜 조작
{{ now() }}                       // 현재 시간
{{ new Date().toISOString() }}    // ISO 형식
{{ new Date().getTime() }}        // 타임스탬프

// 조건문
{{ $json.age > 18 ? "Adult" : "Minor" }}
{{ $json.status === 'active' ? "OK" : "Error" }}
```

### 실무 예시

```javascript
// 이메일 검증
{{ /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($json.email) }}

// 숫자 포맷팅
{{ ($json.amount).toFixed(2) }}

// 배열에서 특정 값 찾기
{{ $json.users.find(u => u.id === 123)?.name }}

// 조건부 필터링
{{ $json.items.filter(x => x.price > 100 && x.inStock) }}

// 평균 계산
{{ $json.scores.reduce((a,b) => a+b, 0) / $json.scores.length }}

// 중복 제거
{{ [...new Set($json.tags)] }}
```

---

## 체크리스트

기본 노드를 이해했는지 확인:

- [ ] Webhook과 Schedule의 차이를 알 수 있다
- [ ] HTTP Request로 API 호출할 수 있다
- [ ] Set 노드로 데이터를 변환할 수 있다
- [ ] If/Switch로 조건 분기가 가능하다
- [ ] Loop로 배열을 반복 처리할 수 있다
- [ ] Slack, Email로 알림을 보낼 수 있다
- [ ] 표현식을 사용해 동적 값을 생성할 수 있다

모두 완료했다면, 다음 장 [05_데이터처리.md](05_데이터처리.md)로 이동하세요!
