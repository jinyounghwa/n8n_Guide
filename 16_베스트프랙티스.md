# 16_베스트프랙티스: 프로덕션 워크플로우 설계

워크플로우가 단순히 "작동하는 것"을 넘어, 안정적이고 유지보수가 가능하며 확장성 있게 설계하는 방법을 학습합니다.

---

## 1. 구조적 설계 (Clean Workflow)

### 가독성 향상
- **노드 이름 변경**: `HTTP Request` 대신 `Get Customer Data`와 같이 목적을 명시하세요.
- **Sticky Notes 활용**: 복잡한 로직 블록에는 설명을 기록하세요.
- **색상 코딩**: 입력(녹색), 처리(노란색), 출력(파란색), 에러 처리(빨간색) 등 자신만의 규칙을 만드세요.

### 모듈화
- **브랜칭 최소화**: 너무 많은 IF/Switch 노드는 워크플로우를 "스파게티"로 만듭니다.
- **Sub-workflow 활용**: 반복되는 기능은 별도의 워크플로우로 분리하고 `Execute Workflow` 노드로 호출하세요.

---

## 2. Gemini + Execute Command 연동 (심화)

n8n의 전용 AI 노드 외에도, `Execute Command` 노드를 활용하여 로컬 스크립트나 CLI를 통해 Gemini(Google AI)를 더 강력하게 제어할 수 있습니다.

### 왜 Execute Command인가?
- 전용 노드에서 지원하지 않는 최신 API 옵션 활용 가능
- 로컬 Python 라이브러리(Google Generative AI SDK) 연동
- 복잡한 전처리/후처리 스크립트와 통합 가능

### 실습: Python 스크립트를 통한 Gemini 호출

1. **사전 준비**: 로컬 환경에 SDK 설치
   ```bash
   pip install -q -U google-generativeai
   ```

2. **Python 스크립트 작성 (`gemini_call.py`)**:
   ```python
   import google.generativeai as genai
   import sys
   import json

   genai.configure(api_key="YOUR_GEMINI_API_KEY")
   model = genai.GenerativeModel('gemini-pro')

   prompt = sys.argv[1]
   response = model.generate_content(prompt)

   print(json.dumps({"response": response.text}))
   ```

3. **n8n 설정**:
   - **Execute Command 노드** 추가
   - **Command**: `python c:/path/to/gemini_call.py "{{ $json.prompt }}"`
   - **Execute Once**: On (배치 처리가 아닌 경우)

### 보안 주의사항
- `Execute Command`는 서버의 로컬 명령을 실행하므로, 외부 입력값을 직접 명령어로 전달할 때 **명령어 주입(Injections)** 공격에 주의해야 합니다. 입력값을 반드시 이스케이프하거나 API 노드를 우선적으로 고려하세요.

---

## 3. 유지보수 및 보안

### 환경 변수 활용
- API Key, DB 접속 정보 등은 노드에 직접 적지 말고 `Credentials` 기능을 사용하거나 OS 환경 변수를 `$vars`를 통해 참조하세요.

### 버전 관리
- 워크플로우를 JSON으로 내보내(Export) Git 리포지토리에 저장하는 습관을 들이세요.
- 중요한 변경 사항은 반드시 백업 후 진행하세요.

### 에러 핸들링 전략
- 모든 핵심 노드에는 **On Error -> Continue** 또는 **Error Trigger**를 연결하여 전체 프로세스가 멈추지 않게 하세요.

---

## 🔗 링크
- **[17_성능최적화.md](17_성능최적화.md)**: 다음 단계
- **[README.md](README.md)**: 메인 가이드로 돌아가기
